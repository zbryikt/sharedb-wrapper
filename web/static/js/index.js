// Generated by LiveScript 1.3.1
(function(){
  var textarea, handle, submit, url, socket, connection, doc, click, btn, a, b, ret;
  textarea = ld$.find(document, 'textarea', 0);
  handle = function(ops, source){
    return textarea.value = JSON.stringify(doc.data);
  };
  submit = function(op, opt){
    return doc.submitOp(op);
  };
  url = {
    scheme: 'http',
    domain: 'sharedb.local'
  };
  socket = new WebSocket((url.scheme === 'http' ? 'ws' : 'wss') + "://" + url.domain + "/ws");
  connection = new sharedb.Connection(socket);
  doc = connection.get('doc', '12r6');
  console.log('doc:', doc);
  doc.on('load', function(){
    return console.log('loaded', doc.data);
  });
  doc.fetch(function(e){
    var ret;
    console.log('fetched');
    doc.subscribe(function(ops, source){
      handle(ops, source);
      return console.log('subscribed.');
    });
    doc.on('op', function(ops, source){
      handle(ops, source);
      return console.log('onop!');
    });
    if (!doc.type) {
      console.log("create doc");
      return ret = doc.create({});
    } else {
      return console.log('ok');
    }
  });
  click = function(){
    if (!doc.data.x) {
      submit({
        p: ["x"],
        oi: {
          a: 0
        }
      });
    }
    return submit({
      p: ["x", "a"],
      na: 1
    });
  };
  btn = ld$.find(document, '.btn')[0];
  btn.addEventListener('click', click);
  a = {
    x: {
      a: 1
    }
  };
  b = {
    x: {
      a: 2
    }
  };
  ret = json0OtDiff(a, b);
  return console.log(">", ret);
})();