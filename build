#!/usr/bin/env bash
mkdir -p dist
echo "build src/server.ls -> dist/server.js ..."
./node_modules/.bin/lsc -cbp src/server.ls > dist/server.js
echo "build src/client.ls -> dist/sharedb-wrapper.js ..."
./node_modules/.bin/lsc -cbp src/client.ls > dist/sharedb-wrapper.js
echo "build src/ot-diff.ls -> dist/ot-diff.js ..."
./node_modules/.bin/lsc -cbp src/ot-diff.ls > dist/ot-diff.js
echo "bundling src/ot-diff.ls for browser ... "
./node_modules/.bin/browserify dist/ot-diff.js -o dist/ot-diff.js
echo "minifying sharedb-wrapper.js ..."
./node_modules/.bin/uglifyjs dist/sharedb-wrapper.js > dist/sharedb-wrapper.min.js
echo "deploy client js to web/ ..."
mkdir -p web/static/assets/
cp dist/ot-diff.js web/static/assets/
cp dist/sharedb-wrapper.min.js web/static/assets/
echo "done."

