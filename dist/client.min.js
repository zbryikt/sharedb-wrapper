(function(){function n(n,e){var t={}.hasOwnProperty;for(var r in e)t.call(e,r)&&(n[r]=e[r]);return n}var e,t;e=require("sharedb"),(t=function(e){var t;return null==e&&(e={}),n(this,{scheme:(e.url||(e.url={})).scheme||window.location.protocol.replace(":",""),domain:e.url.domain||window.location.host,path:t=e.url.path||"/ws"}),this.path="/"===t[0]?t:"/"+t,this.scheme="http"===this.scheme?"ws":"wss",this.evtHandler={},this.reconnectInfo={retry:0,pending:[]},this.reconnect(),this}).prototype=n(Object.create(Object.prototype),{getSnapshot:function(n){var e,t,r,o=this;return e=n.id,t=n.version,r=n.collection,new Promise(function(n,c){return o.connection.fetchSnapshot(null!=r?r:"doc",e,null!=t?t:null,function(e,t){return e?c(e):n(t)})})},ready:function(){var n=this;return new Promise(function(e,t){return n.connected?e():n.reconnectInfo.handler?n.reconnectInfo.pending.push({res:e,rej:t}):n.reconnect()})},get:function(n){var e,t,r,o,c=this;return e=n.id,t=n.watch,r=n.create,o=n.collection,(this.connection?Promise.resolve():this.reconnect()).then(function(){return new Promise(function(n,i){var u;return(u=c.connection.get(null!=o?o:"doc",e)).fetch(function(e){return e?i(e):(u.subscribe(function(e,t){return n(u)}),u.on("error",function(n){return c.fire("error",{doc:u,err:n})}),null!=t&&u.on("op",function(n,e){return t(n,e)}),u.type?void 0:u.create((r?r():null)||{}))})})})},on:function(n,e){var t;return((t=this.evtHandler)[n]||(t[n]=[])).push(e)},fire:function(n){var e,t,r,o,c,i,u,s=[];for(t=[],r=1,o=arguments.length;r<o;++r)t.push(arguments[r]);for(e=t,r=0,i=(c=this.evtHandler[n]||[]).length;r<i;++r)u=c[r],s.push(u.apply(this,e));return s},disconnect:function(){if(this.socket)return this.socket.close(),this.socket=null,this.connected=!1,this.socket=null},reconnect:function(){var n=this;return new Promise(function(t,r){var o;return n.socket?t():(o=n.reconnectInfo.retry++,o=Math.round(500*Math.pow(o,1.4)),clearTimeout(n.reconnectInfo.handler),console.log("try reconnecting ("+n.reconnectInfo.retry+") after "+o+"ms ..."),n.reconnectInfo.handler=setTimeout(function(){return n.reconnectInfo.handler=null,n.socket=new WebSocket(n.scheme+"://"+n.domain+n.path),n.connection=new e.Connection(n.socket),n.socket.addEventListener("close",function(){return n.socket=null,n.connected=!1,n.fire("close")}),n.socket.addEventListener("open",function(){var e;return n.reconnectInfo.retry=0,((e=n.reconnectInfo).pending||(e.pending=[])).splice(0).map(function(n){return n.res()}),n.connected=!0,t()})},o))})}}),"undefined"!=typeof module&&null!==module&&(module.exports=t),"undefined"!=typeof window&&null!==window&&(window.sharedbWrapper=t)}).call(this);
