// Generated by LiveScript 1.3.1
var sharedb, sharedbPostgres, ws, http, websocketJsonStream, sharedbWrapper;
sharedb = require('sharedb');
sharedbPostgres = require('sharedb-postgres');
ws = require('ws');
http = require('http');
websocketJsonStream = require('websocket-json-stream');
sharedbWrapper = function(arg$){
  var app, config, server, sdb, connect, wss, ret;
  app = arg$.app, config = arg$.config;
  server = http.createServer(app);
  sdb = new sharedb({
    db: sharedbPostgres(config)
  });
  connect = sdb.connect();
  wss = new ws.Server({
    server: server
  });
  wss.on('connection', function(ws, req){
    var wjs;
    sdb.listen(wjs = websocketJsonStream(ws));
    return ws.on('close', function(){});
  });
  sdb.use('readSnapshots', function(req, cb){
    var doc;
    doc = connect.get('doc', req.id);
    doc.fetch(function(){
      return doc.subscribe(function(){});
    });
    return cb();
  });
  return ret = {
    server: server,
    sharedb: sdb,
    connect: connect,
    wss: wss
  };
};
module.exports = sharedbWrapper;
